Vagrant.configure("2") do |config|
        config.vm.box = "ubuntu/jammy64"
        config.vm.hostname = "sshd-notify-test"

        config.vm.provision "shell", inline: <<-SHELL
            set -e
            echo 'TOKEN="PUT_YOUR_BOT_TOKEN_HERE"' >> /etc/sshd_notify
            echo 'CHAT_ID="PUT_YOUR_CHAT_ID_HERE"' >> /etc/sshd_notify
            chmod 600 /etc/sshd_notify && chown root:root /etc/sshd_notify
            apt-get update
            apt-get install -y curl
            cat << 'EOF' > /usr/local/bin/ssh_tg_notify.sh
        #!/bin/bash
        [ -f /etc/sshd_notify ] && . /etc/sshd_notify
        if [ "$PAM_TYPE" != "close_session" ]; then
            HOST=$(hostname)
            MSG="*Vagrant SSH Alert*%0A*Server:* $HOST%0A*User:* $PAM_USER%0A*IP:* $PAM_RHOST"
            curl -s -X POST "https://api.telegram.org/bot$TOKEN/sendMessage" \
                -d "chat_id=$CHAT_ID" \
                -d "text=$MSG" \
                -d "parse_mode=Markdown"
        fi
        EOF
            chmod +x /usr/local/bin/ssh_tg_notify.sh
            echo "session optional pam_exec.so /usr/local/bin/ssh_tg_notify.sh" >> /etc/pam.d/sshd
            systemctl restart ssh
        SHELL
        end